<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡åšç©ºè¨Šè™Ÿè©•åˆ†ç³»çµ± Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Microsoft JhengHei', sans-serif; background: linear-gradient(135deg, #0f0f23 0%, #1a1a3e 100%); color: #eee; min-height: 100vh; padding: 15px; }
        .container { max-width: 1600px; margin: 0 auto; }
        header { text-align: center; padding: 20px; background: rgba(255,255,255,0.03); border-radius: 15px; margin-bottom: 20px; border: 1px solid rgba(255,255,255,0.1); }
        header h1 { font-size: 1.8em; background: linear-gradient(90deg, #ff416c, #ff4b2b, #f7971e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .subtitle { color: #888; margin-top: 8px; }
        .recommendation-box { background: linear-gradient(135deg, rgba(255,65,108,0.15), rgba(255,75,43,0.15)); border: 2px solid; border-radius: 20px; padding: 30px; margin-bottom: 25px; text-align: center; }
        .rec-title { font-size: 1.3em; margin-bottom: 15px; }
        .rec-action { font-size: 2.5em; font-weight: bold; margin: 15px 0; }
        .rec-detail { font-size: 1.1em; color: #ccc; line-height: 1.8; }
        .rec-wait { border-color: #666; } .rec-watch { border-color: #feca57; } .rec-prepare { border-color: #ff9f43; }
        .rec-trial { border-color: #ff6b6b; } .rec-build { border-color: #ee5a24; } .rec-add { border-color: #eb2f06; }
        .rec-heavy { border-color: #ff0000; animation: glow 1.5s infinite; }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.3); } 50% { box-shadow: 0 0 40px rgba(255,0,0,0.6); } }
        .score-display { display: flex; justify-content: center; gap: 25px; flex-wrap: wrap; margin: 25px 0; }
        .score-item { text-align: center; padding: 15px 20px; background: rgba(255,255,255,0.05); border-radius: 15px; min-width: 110px; }
        .score-value { font-size: 2.2em; font-weight: bold; }
        .score-label { color: #888; margin-top: 5px; font-size: 0.85em; }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-bottom: 15px; }
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
        .card { background: rgba(255,255,255,0.03); border-radius: 15px; padding: 18px; border: 1px solid rgba(255,255,255,0.08); }
        .card-title { font-size: 1em; color: #48dbfb; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .indicator-item { display: flex; justify-content: space-between; align-items: center; padding: 7px 10px; margin: 4px 0; background: rgba(255,255,255,0.02); border-radius: 6px; border-left: 3px solid transparent; font-size: 0.9em; }
        .indicator-item.triggered { background: rgba(255,107,107,0.15); border-left-color: #ff6b6b; }
        .ind-name { flex: 1; } .ind-value { min-width: 60px; text-align: right; font-family: monospace; font-size: 0.85em; }
        .ind-weight { min-width: 30px; text-align: center; font-size: 0.75em; color: #666; } .ind-status { min-width: 20px; text-align: center; }
        .price-box { text-align: center; padding: 10px; }
        .price-main { font-size: 1.8em; font-weight: bold; }
        .price-change { font-size: 0.95em; margin-top: 3px; }
        .up { color: #ff6b6b; } .down { color: #26de81; }
        .ma-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin-top: 8px; }
        .ma-item { text-align: center; padding: 6px; background: rgba(255,255,255,0.03); border-radius: 6px; }
        .ma-item .value { font-size: 0.95em; font-weight: bold; } .ma-item .label { font-size: 0.65em; color: #888; }
        .ma-item.above { border-bottom: 2px solid #26de81; } .ma-item.below { border-bottom: 2px solid #ff6b6b; }
        .divergence-alert { background: linear-gradient(135deg, rgba(255,193,7,0.2), rgba(255,152,0,0.2)); border: 1px solid #ffc107; border-radius: 10px; padding: 15px; margin: 15px 0; text-align: center; }
        .divergence-alert h4 { color: #ffc107; margin-bottom: 8px; }
        .action-table { width: 100%; margin-top: 12px; font-size: 0.85em; }
        .action-table th, .action-table td { padding: 8px 5px; text-align: left; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .action-table th { color: #888; font-weight: normal; } .action-row.current { background: rgba(255,107,107,0.2); }
        .chart-container { height: 220px; margin-top: 12px; }
        .loading { text-align: center; padding: 80px 20px; }
        .spinner { width: 50px; height: 50px; border: 4px solid #333; border-top-color: #ff6b6b; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .error-box { background: rgba(255,107,107,0.2); border: 1px solid #ff6b6b; padding: 25px; border-radius: 10px; text-align: center; }
        footer { text-align: center; padding: 15px; color: #555; font-size: 0.8em; margin-top: 20px; }
        @media (max-width: 768px) { .grid, .grid-2 { grid-template-columns: 1fr; } .score-display { gap: 8px; } .score-item { min-width: 70px; padding: 10px; } .score-value { font-size: 1.6em; } .rec-action { font-size: 1.5em; } }
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>ğŸ¯ å°è‚¡åšç©ºè¨Šè™Ÿè©•åˆ†ç³»çµ± Pro</h1>
        <p class="subtitle">æ•´åˆåŠ æ¬ŠæŒ‡æ•¸ã€OTCæ«ƒè²·ã€å°ç©é›»çš„å¤šç¶­åº¦åˆ†æ</p>
        <p class="subtitle">è³‡æ–™æ—¥æœŸï¼š<span id="dataDate">è¼‰å…¥ä¸­...</span></p>
    </header>
    <div id="mainContent"><div class="loading"><div class="spinner"></div><p>æ­£åœ¨è¼‰å…¥è³‡æ–™...</p></div></div>
    <footer><p>âš ï¸ é¢¨éšªè­¦å‘Šï¼šåšç©ºæ“ä½œé¢¨éšªæ¥µé«˜ã€‚æœ¬ç³»çµ±åƒ…ä¾›è³‡æ–™æ•´ç†åƒè€ƒï¼ŒæŠ•è³‡æ±ºç­–èˆ‡ç›ˆè™§ç”±ä½¿ç”¨è€…è‡ªè¡Œæ‰¿æ“”ã€‚</p></footer>
</div>
<script>
const CONFIG = {
    TXINDEX_URL: 'https://raw.githubusercontent.com/rexdashu168/twindex/main/TXINDEX.xlsx',
    OTC_URL: 'https://raw.githubusercontent.com/rexdashu168/twindex/main/OTCindex.xlsx',
    TSMC_URL: 'https://raw.githubusercontent.com/rexdashu168/twindex/main/2330.xlsx',
};
let processed = [];
window.onload = () => loadAllData();

async function loadAllData() {
    try {
        const [txData, otcData, tsmcData] = await Promise.all([fetchXLSX(CONFIG.TXINDEX_URL), fetchXLSX(CONFIG.OTC_URL), fetchXLSX(CONFIG.TSMC_URL)]);
        processData(txData, otcData, tsmcData);
    } catch (err) {
        document.getElementById('mainContent').innerHTML = '<div class="error-box"><h3>âŒ è¼‰å…¥å¤±æ•—</h3><p style="margin-top:10px;color:#aaa;">'+err.message+'</p><button onclick="loadAllData()" style="margin-top:15px;padding:10px 25px;background:#667eea;border:none;border-radius:5px;color:#fff;cursor:pointer;">é‡è©¦</button></div>';
    }
}

async function fetchXLSX(url) {
    const response = await fetch(url);
    if (!response.ok) throw new Error('ç„¡æ³•è¼‰å…¥: ' + url);
    const buffer = await response.arrayBuffer();
    const workbook = XLSX.read(buffer, { type: 'array' });
    return XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]], { raw: false });
}

function parseNum(v) {
    if (v === null || v === undefined || v === '' || v === 'NaN' || v === 'N/A') return NaN;
    let s = String(v).replace(/,/g, '');
    if (s.includes('å„„')) return parseFloat(s.replace('å„„', '')) * 1e8;
    if (s.includes('è¬')) return parseFloat(s.replace('è¬', '')) * 1e4;
    return parseFloat(s);
}

function parseDate(v) {
    if (!v) return null;
    if (typeof v === 'number') return new Date((v - 25569) * 86400 * 1000).toISOString().split('T')[0].replace(/-/g, '/');
    return String(v).split(' ')[0];
}

function calcMA(data, field, period) {
    return data.map((_, i) => {
        if (i < period - 1) return NaN;
        let sum = 0; for (let j = 0; j < period; j++) sum += data[i - j][field];
        return sum / period;
    });
}

function calcRSI(data, field, period) {
    let result = [], gains = [], losses = [];
    for (let i = 0; i < data.length; i++) {
        if (i === 0) { result.push(50); continue; }
        let change = data[i][field] - data[i-1][field];
        gains.push(change > 0 ? change : 0); losses.push(change < 0 ? -change : 0);
        if (i < period) result.push(50);
        else {
            let avgG = gains.slice(-period).reduce((a,b)=>a+b,0) / period;
            let avgL = losses.slice(-period).reduce((a,b)=>a+b,0) / period;
            result.push(avgL === 0 ? 100 : 100 - (100 / (1 + avgG/avgL)));
        }
    }
    return result;
}

function processData(txRaw, otcRaw, tsmcRaw) {
    let txData = txRaw.map(row => ({ date: parseDate(row['æ™‚é–“']), close: parseNum(row['æ”¶ç›¤åƒ¹']), volume: parseNum(row['æˆäº¤é‡']), foreign: parseNum(row['è²·è³£è¶…(å…ƒ)']), trust: parseNum(row['è²·è³£è¶…(å…ƒ).1']), margin: parseNum(row['èè³‡(å…ƒ)']) })).filter(d => !isNaN(d.close) && d.date);
    let otcMap = {}, tsmcMap = {};
    otcRaw.forEach(row => { let date = parseDate(row['æ™‚é–“']); if (date) otcMap[date] = parseNum(row['æ”¶ç›¤åƒ¹']); });
    tsmcRaw.forEach(row => { let date = parseDate(row['æ™‚é–“']); if (date) tsmcMap[date] = parseNum(row['æ”¶ç›¤åƒ¹']); });
    let merged = txData.map(tx => ({ ...tx, otcClose: otcMap[tx.date] || NaN, tsmcClose: tsmcMap[tx.date] || NaN })).filter(d => !isNaN(d.otcClose) && !isNaN(d.tsmcClose));
    merged = merged.slice(-150);
    
    let txMa5 = calcMA(merged, 'close', 5), txMa20 = calcMA(merged, 'close', 20), txMa60 = calcMA(merged, 'close', 60), txRsi = calcRSI(merged, 'close', 14);
    let otcMa5 = calcMA(merged, 'otcClose', 5), otcMa20 = calcMA(merged, 'otcClose', 20), otcMa60 = calcMA(merged, 'otcClose', 60);
    let tsmcMa5 = calcMA(merged, 'tsmcClose', 5), tsmcMa20 = calcMA(merged, 'tsmcClose', 20), tsmcMa60 = calcMA(merged, 'tsmcClose', 60);
    
    processed = merged.map((row, i) => {
        let txRet = i > 0 ? (row.close / merged[i-1].close - 1) * 100 : 0;
        let otcRet = i > 0 ? (row.otcClose / merged[i-1].otcClose - 1) * 100 : 0;
        let tsmcRet = i > 0 ? (row.tsmcClose / merged[i-1].tsmcClose - 1) * 100 : 0;
        let txBias20 = txMa20[i] ? (row.close / txMa20[i] - 1) * 100 : 0;
        let txDownDays = 0, otcDownDays = 0, foreignSellDays = 0;
        for (let j = i; j >= 0 && (j === 0 || merged[j].close < merged[j-1].close); j--) txDownDays++;
        for (let j = i; j >= 0 && (j === 0 || merged[j].otcClose < merged[j-1].otcClose); j--) otcDownDays++;
        for (let j = i; j >= 0 && merged[j].foreign < 0; j--) foreignSellDays++;
        let marginChange = i >= 20 && merged[i-20].margin ? (row.margin / merged[i-20].margin - 1) * 100 : 0;
        let gain60 = i >= 60 ? (row.close / merged[i-60].close - 1) * 100 : 0;
        let gain120 = i >= 120 ? (row.close / merged[i-120].close - 1) * 100 : 0;
        let high52 = row.close; for (let j = 0; j < Math.min(240, i+1); j++) if (merged[i-j].close > high52) high52 = merged[i-j].close;
        let distHigh = (row.close / high52 - 1) * 100;
        let tx5Ret = i >= 5 ? (row.close / merged[i-5].close - 1) * 100 : 0;
        let otc5Ret = i >= 5 ? (row.otcClose / merged[i-5].otcClose - 1) * 100 : 0;
        return { date: row.date, txClose: row.close, txRet, txBias20, txRsi: txRsi[i], txMa5: txMa5[i], txMa20: txMa20[i], txMa60: txMa60[i], txDownDays, otcClose: row.otcClose, otcRet, otcMa5: otcMa5[i], otcMa20: otcMa20[i], otcMa60: otcMa60[i], otcDownDays, otcTxGap5: otc5Ret - tx5Ret, tsmcClose: row.tsmcClose, tsmcRet, tsmcMa5: tsmcMa5[i], tsmcMa20: tsmcMa20[i], tsmcMa60: tsmcMa60[i], foreign: row.foreign, foreignSellDays, trust: row.trust, marginChange, gain60, gain120, distHigh };
    });
    renderDashboard();
}

function renderDashboard() {
    const d = processed[processed.length - 1];
    document.getElementById('dataDate').textContent = d.date;
    
    const indicators = {
        overheat: [
            { name: 'RSI > 70', value: d.txRsi, check: d.txRsi > 70, weight: 1 },
            { name: 'RSI > 75', value: d.txRsi, check: d.txRsi > 75, weight: 1 },
            { name: 'ä¹–é›¢ç‡ > 3%', value: d.txBias20, check: d.txBias20 > 3, weight: 1 },
            { name: 'ä¹–é›¢ç‡ > 5%', value: d.txBias20, check: d.txBias20 > 5, weight: 1 },
            { name: 'èè³‡å¢ > 5%', value: d.marginChange, check: d.marginChange > 5, weight: 1 },
            { name: '60æ—¥æ¼² > 15%', value: d.gain60, check: d.gain60 > 15, weight: 1 },
            { name: '120æ—¥æ¼² > 25%', value: d.gain120, check: d.gain120 > 25, weight: 1 },
            { name: 'æ¥è¿‘52é€±é«˜', value: d.distHigh, check: d.distHigh > -3, weight: 1 },
        ],
        otc: [
            { name: 'OTCç ´20å‡(å¤§ç›¤æ²’ç ´)', value: 'check', check: d.otcClose < d.otcMa20 && d.txClose > d.txMa20, weight: 2, display: d.otcClose < d.otcMa20 && d.txClose > d.txMa20 ? 'æ˜¯' : 'å¦' },
            { name: 'OTCç ´60å‡(å¤§ç›¤æ²’ç ´)', value: 'check', check: d.otcClose < d.otcMa60 && d.txClose > d.txMa60, weight: 3, display: d.otcClose < d.otcMa60 && d.txClose > d.txMa60 ? 'æ˜¯' : 'å¦' },
            { name: 'OTCé»‘/å¤§ç›¤ç´…', value: 'check', check: d.otcRet < 0 && d.txRet > 0, weight: 2, display: d.otcRet < 0 && d.txRet > 0 ? 'æ˜¯' : 'å¦' },
            { name: 'OTC 5æ—¥å¼±>2%', value: d.otcTxGap5, check: d.otcTxGap5 < -2, weight: 2 },
            { name: 'OTCé€£è·Œâ‰¥3å¤©', value: d.otcDownDays, check: d.otcDownDays >= 3, weight: 1 },
        ],
        price: [
            { name: 'æ”¶é»‘K', value: d.txRet, check: d.txRet < 0, weight: 1 },
            { name: 'å¤§é»‘K (>1%)', value: d.txRet, check: d.txRet < -1, weight: 2 },
            { name: 'è·Œç ´5æ—¥å‡', value: 'check', check: d.txClose < d.txMa5, weight: 1, display: d.txClose < d.txMa5 ? 'æ˜¯' : 'å¦' },
            { name: 'è·Œç ´20æ—¥å‡', value: 'check', check: d.txClose < d.txMa20, weight: 2, display: d.txClose < d.txMa20 ? 'æ˜¯' : 'å¦' },
            { name: 'è·Œç ´60æ—¥å‡', value: 'check', check: d.txClose < d.txMa60, weight: 3, display: d.txClose < d.txMa60 ? 'æ˜¯' : 'å¦' },
            { name: 'é€£è·Œâ‰¥2å¤©', value: d.txDownDays, check: d.txDownDays >= 2, weight: 1 },
        ],
        chip: [
            { name: 'å¤–è³‡è³£è¶…', value: d.foreign, check: d.foreign < 0, weight: 2 },
            { name: 'å¤–è³‡é€£è³£â‰¥2å¤©', value: d.foreignSellDays, check: d.foreignSellDays >= 2, weight: 2 },
            { name: 'å¤–è³‡é€£è³£â‰¥3å¤©', value: d.foreignSellDays, check: d.foreignSellDays >= 3, weight: 3 },
            { name: 'æŠ•ä¿¡è³£è¶…', value: d.trust, check: d.trust < 0, weight: 1 },
        ],
        tsmc: [
            { name: 'å°ç©æ”¶é»‘', value: d.tsmcRet, check: d.tsmcRet < 0, weight: 1 },
            { name: 'å°ç©è·Œ>1%', value: d.tsmcRet, check: d.tsmcRet < -1, weight: 2 },
            { name: 'å°ç©ç ´20å‡', value: 'check', check: d.tsmcClose < d.tsmcMa20, weight: 2, display: d.tsmcClose < d.tsmcMa20 ? 'æ˜¯' : 'å¦' },
            { name: 'å°ç©ç ´60å‡', value: 'check', check: d.tsmcClose < d.tsmcMa60, weight: 3, display: d.tsmcClose < d.tsmcMa60 ? 'æ˜¯' : 'å¦' },
        ],
    };
    
    let overheatScore = indicators.overheat.filter(i => i.check).reduce((s,i) => s + i.weight, 0);
    let otcScore = indicators.otc.filter(i => i.check).reduce((s,i) => s + i.weight, 0);
    let priceScore = indicators.price.filter(i => i.check).reduce((s,i) => s + i.weight, 0);
    let chipScore = indicators.chip.filter(i => i.check).reduce((s,i) => s + i.weight, 0);
    let tsmcScore = indicators.tsmc.filter(i => i.check).reduce((s,i) => s + i.weight, 0);
    let shortScore = otcScore + priceScore + chipScore + tsmcScore;
    let totalTriggered = [...indicators.otc, ...indicators.price, ...indicators.chip, ...indicators.tsmc].filter(i => i.check).length;
    
    let otcLeading = d.otcClose < d.otcMa20 && d.txClose > d.txMa20;
    let otcDiverge = d.otcRet < -0.5 && d.txRet > 0;
    
    function getWinRate(score) { if (score >= 16) return { rate: 48.2, big: 13.5 }; if (score >= 10) return { rate: 46.5, big: 12.0 }; return { rate: 45.0, big: 10.0 }; }
    let winData = getWinRate(shortScore);
    
    function getRecommendation() {
        if (d.txClose < d.txMa60 && d.tsmcClose < d.tsmcMa60 && shortScore >= 12) return { level: 'heavy', action: 'ğŸ”¥ å¼·åŠ›åšç©º', detail: 'å¤§ç›¤+å°ç©å‡ç ´60å‡ï¼Œç©ºæ–¹ç¸½åˆ†'+shortScore+'<br><b>å»ºè­°ï¼šéƒ¨ä½80%ï¼Œåœæåå½ˆé«˜é»+1%</b>', class: 'rec-heavy' };
        if (d.txClose < d.txMa60 && shortScore >= 10) return { level: 'add', action: 'ğŸ“‰ åŠ ç¢¼åšç©º', detail: 'å¤§ç›¤ç ´60å‡ï¼Œç©ºæ–¹'+shortScore+'åˆ†<br><b>å»ºè­°ï¼šéƒ¨ä½50%ï¼Œåœæ60å‡+2%</b>', class: 'rec-add' };
        if (d.txClose < d.txMa20 && shortScore >= 7) return { level: 'build', action: 'ğŸ“Š å»ºå€‰åšç©º', detail: 'å¤§ç›¤ç ´20å‡ï¼Œç©ºæ–¹'+shortScore+'åˆ†<br><b>å»ºè­°ï¼šéƒ¨ä½30%ï¼Œåœæ20å‡+2%</b>', class: 'rec-build' };
        if ((overheatScore >= 4 || otcLeading) && shortScore >= 4) return { level: 'trial', action: 'ğŸ¯ è©¦å–®åšç©º', detail: 'éç†±'+overheatScore+'/8ï¼ŒOTCé ˜å…ˆ'+(otcLeading?'æ˜¯':'å¦')+'<br><b>å»ºè­°ï¼šè©¦å–®10%ï¼Œåœæ+3%</b>', class: 'rec-trial' };
        if (overheatScore >= 4 || otcLeading) return { level: 'prepare', action: 'âš¡ æº–å‚™åšç©º', detail: 'éç†±'+overheatScore+'/8'+(otcLeading ? 'ï¼ŒOTCå·²é ˜å…ˆè½‰å¼±' : '')+'<br><b>å»ºè­°ï¼šç­‰å¾…è½‰å¼±è¨Šè™Ÿ</b>', class: 'rec-prepare' };
        if (overheatScore >= 2 || otcScore >= 2) return { level: 'watch', action: 'ğŸ‘€ å¯†åˆ‡è§€å¯Ÿ', detail: 'éç†±'+overheatScore+'/8ï¼ŒOTCè¨Šè™Ÿ'+otcScore+'<br><b>å»ºè­°ï¼šè§€å¯ŸOTCæ˜¯å¦è½‰å¼±</b>', class: 'rec-watch' };
        return { level: 'wait', action: 'â³ ç­‰å¾…æ™‚æ©Ÿ', detail: 'å¸‚å ´æœªéç†±ï¼ŒOTCç„¡è½‰å¼±<br><b>å»ºè­°ï¼šä¿æŒè§€æœ›</b>', class: 'rec-wait' };
    }
    let rec = getRecommendation();
    
    function renderInd(list) {
        return list.map(ind => {
            let val = ind.display !== undefined ? ind.display : (typeof ind.value === 'number' ? (Math.abs(ind.value) >= 1e8 ? (ind.value/1e8).toFixed(1)+'å„„' : ind.value.toFixed(2)) : ind.value);
            return '<div class="indicator-item '+(ind.check?'triggered':'')+'"><span class="ind-name">'+ind.name+'</span><span class="ind-value">'+val+'</span><span class="ind-weight">'+(ind.check?'+'+ind.weight:'')+'</span><span class="ind-status">'+(ind.check?'ğŸ”´':'âšª')+'</span></div>';
        }).join('');
    }
    
    let html = '<div class="recommendation-box '+rec.class+'"><div class="rec-title">ğŸ“Œ ä»Šæ—¥æ“ä½œå»ºè­°</div><div class="rec-action">'+rec.action+'</div><div class="rec-detail">'+rec.detail+'</div></div>';
    
    if (otcLeading || otcDiverge) html += '<div class="divergence-alert"><h4>âš ï¸ OTCé ˜å…ˆé è­¦</h4><p>'+(otcLeading?'OTCå·²ç ´20å‡ï¼Œå¤§ç›¤é‚„åœ¨20å‡ä¸Šï¼ä¸­å°å‹è‚¡è³‡é‡‘æ’¤é€€ä¸­ã€‚':'')+'</p><p>'+(otcDiverge?'OTCæ”¶é»‘ä½†å¤§ç›¤æ”¶ç´…ï¼å¸‚å ´èƒŒé›¢ã€‚':'')+'</p><p style="margin-top:8px;color:#ffc107;font-size:0.9em;">æ­·å²ï¼šæ­¤è¨Šè™Ÿå¾Œ10æ—¥ä¸‹è·Œç‡ç´„47%ï¼Œå¹³å‡å ±é…¬-0.5%</p></div>';
    
    html += '<div class="score-display"><div class="score-item"><div class="score-value" style="color:'+(overheatScore>=4?'#ff6b6b':'#feca57')+'">'+overheatScore+'</div><div class="score-label">éç†± /8</div></div><div class="score-item"><div class="score-value" style="color:'+(otcScore>=3?'#ff6b6b':otcScore>=2?'#feca57':'#48dbfb')+'">'+otcScore+'</div><div class="score-label">OTCé ˜å…ˆ</div></div><div class="score-item"><div class="score-value" style="color:'+(shortScore>=12?'#ff0000':shortScore>=7?'#ff6b6b':'#48dbfb')+'">'+shortScore+'</div><div class="score-label">ç©ºæ–¹ç¸½åˆ†</div></div><div class="score-item"><div class="score-value">'+totalTriggered+'</div><div class="score-label">è§¸ç™¼æ•¸</div></div><div class="score-item"><div class="score-value" style="color:'+(winData.rate>=47?'#ff6b6b':'#feca57')+'">'+winData.rate+'%</div><div class="score-label">æ­·å²è·Œç‡</div></div></div>';
    
    html += '<div class="grid"><div class="card"><div class="card-title">ğŸ“Š åŠ æ¬ŠæŒ‡æ•¸</div><div class="price-box"><div class="price-main">'+d.txClose.toLocaleString()+'</div><div class="price-change '+(d.txRet>=0?'up':'down')+'">'+(d.txRet>=0?'â–²':'â–¼')+' '+Math.abs(d.txRet).toFixed(2)+'%</div></div><div class="ma-grid"><div class="ma-item '+(d.txClose>d.txMa5?'above':'below')+'"><div class="value">'+(d.txMa5?.toFixed(0)||'-')+'</div><div class="label">5æ—¥å‡</div></div><div class="ma-item '+(d.txClose>d.txMa20?'above':'below')+'"><div class="value">'+(d.txMa20?.toFixed(0)||'-')+'</div><div class="label">20æ—¥å‡</div></div><div class="ma-item '+(d.txClose>d.txMa60?'above':'below')+'"><div class="value">'+(d.txMa60?.toFixed(0)||'-')+'</div><div class="label">60æ—¥å‡</div></div></div></div>';
    
    html += '<div class="card"><div class="card-title">ğŸ“ˆ OTCæ«ƒè²·æŒ‡æ•¸</div><div class="price-box"><div class="price-main">'+d.otcClose.toFixed(2)+'</div><div class="price-change '+(d.otcRet>=0?'up':'down')+'">'+(d.otcRet>=0?'â–²':'â–¼')+' '+Math.abs(d.otcRet).toFixed(2)+'%</div></div><div class="ma-grid"><div class="ma-item '+(d.otcClose>d.otcMa5?'above':'below')+'"><div class="value">'+(d.otcMa5?.toFixed(2)||'-')+'</div><div class="label">5æ—¥å‡</div></div><div class="ma-item '+(d.otcClose>d.otcMa20?'above':'below')+'"><div class="value">'+(d.otcMa20?.toFixed(2)||'-')+'</div><div class="label">20æ—¥å‡</div></div><div class="ma-item '+(d.otcClose>d.otcMa60?'above':'below')+'"><div class="value">'+(d.otcMa60?.toFixed(2)||'-')+'</div><div class="label">60æ—¥å‡</div></div></div></div>';
    
    html += '<div class="card"><div class="card-title">ğŸ­ å°ç©é›»</div><div class="price-box"><div class="price-main">'+d.tsmcClose.toLocaleString()+'</div><div class="price-change '+(d.tsmcRet>=0?'up':'down')+'">'+(d.tsmcRet>=0?'â–²':'â–¼')+' '+Math.abs(d.tsmcRet).toFixed(2)+'%</div></div><div class="ma-grid"><div class="ma-item '+(d.tsmcClose>d.tsmcMa5?'above':'below')+'"><div class="value">'+(d.tsmcMa5?.toFixed(0)||'-')+'</div><div class="label">5æ—¥å‡</div></div><div class="ma-item '+(d.tsmcClose>d.tsmcMa20?'above':'below')+'"><div class="value">'+(d.tsmcMa20?.toFixed(0)||'-')+'</div><div class="label">20æ—¥å‡</div></div><div class="ma-item '+(d.tsmcClose>d.tsmcMa60?'above':'below')+'"><div class="value">'+(d.tsmcMa60?.toFixed(0)||'-')+'</div><div class="label">60æ—¥å‡</div></div></div></div></div>';
    
    html += '<div class="grid-2 grid"><div class="card"><div class="card-title">ğŸ”® OTCé ˜å…ˆæŒ‡æ¨™ ('+otcScore+'åˆ†)</div>'+renderInd(indicators.otc)+'</div><div class="card"><div class="card-title">ğŸŒ¡ï¸ éç†±æŒ‡æ¨™ ('+overheatScore+'/8)</div>'+renderInd(indicators.overheat)+'</div></div>';
    
    html += '<div class="grid-2 grid"><div class="card"><div class="card-title">ğŸ“ˆ åƒ¹æ ¼è¨Šè™Ÿ ('+priceScore+'åˆ†)</div>'+renderInd(indicators.price)+'</div><div class="card"><div class="card-title">ğŸ’° ç±Œç¢¼+å°ç© ('+(chipScore+tsmcScore)+'åˆ†)</div>'+renderInd(indicators.chip)+renderInd(indicators.tsmc)+'</div></div>';
    
    html += '<div class="card"><div class="card-title">ğŸ“‹ é‡‘å­—å¡”ç­–ç•¥å°ç…§</div><table class="action-table"><tr><th>éšæ®µ</th><th>æ¢ä»¶</th><th>éƒ¨ä½</th><th>åœæ</th><th>ç‹€æ…‹</th></tr><tr class="action-row '+(rec.level==='wait'||rec.level==='watch'?'current':'')+'"><td>è§€å¯Ÿ</td><td>éç†±â‰¥2 æˆ– OTCè¨Šè™Ÿâ‰¥2</td><td>0%</td><td>-</td><td>'+(overheatScore>=2||otcScore>=2?'âœ“':'-')+'</td></tr><tr class="action-row '+(rec.level==='prepare'?'current':'')+'"><td>æº–å‚™</td><td>éç†±â‰¥4 æˆ– OTCé ˜å…ˆç ´å‡</td><td>0%</td><td>-</td><td>'+(overheatScore>=4||otcLeading?'âœ“':'-')+'</td></tr><tr class="action-row '+(rec.level==='trial'?'current':'')+'"><td>è©¦å–®</td><td>æº–å‚™+ç©ºæ–¹â‰¥4</td><td>10%</td><td>+3%</td><td>'+((overheatScore>=4||otcLeading)&&shortScore>=4?'âœ“':'-')+'</td></tr><tr class="action-row '+(rec.level==='build'?'current':'')+'"><td>å»ºå€‰</td><td>ç ´20å‡+ç©ºæ–¹â‰¥7</td><td>30%</td><td>20å‡+2%</td><td>'+(d.txClose<d.txMa20&&shortScore>=7?'âœ“':'-')+'</td></tr><tr class="action-row '+(rec.level==='add'?'current':'')+'"><td>åŠ ç¢¼</td><td>ç ´60å‡+ç©ºæ–¹â‰¥10</td><td>50%</td><td>60å‡+2%</td><td>'+(d.txClose<d.txMa60&&shortScore>=10?'âœ“':'-')+'</td></tr><tr class="action-row '+(rec.level==='heavy'?'current':'')+'"><td>é‡å£“</td><td>ç ´60å‡+å°ç©ç ´60å‡+ç©ºæ–¹â‰¥12</td><td>80%</td><td>é«˜é»+1%</td><td>'+(d.txClose<d.txMa60&&d.tsmcClose<d.tsmcMa60&&shortScore>=12?'âœ“':'-')+'</td></tr></table></div>';
    
    html += '<div class="card"><div class="card-title">ğŸ“ˆ è¿‘æœŸèµ°å‹¢</div><div class="chart-container"><canvas id="priceChart"></canvas></div></div>';
    
    document.getElementById('mainContent').innerHTML = html;
    
    const ctx = document.getElementById('priceChart').getContext('2d');
    const last35 = processed.slice(-35);
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: last35.map(d => d.date.slice(5)),
            datasets: [
                { label: 'åŠ æ¬Š', data: last35.map(d => d.txClose), borderColor: '#48dbfb', fill: false, tension: 0.3, yAxisID: 'y' },
                { label: 'OTC', data: last35.map(d => d.otcClose), borderColor: '#feca57', fill: false, tension: 0.3, yAxisID: 'y1' },
                { label: '20å‡', data: last35.map(d => d.txMa20), borderColor: '#ff6b6b', borderDash: [5,5], fill: false, pointRadius: 0, yAxisID: 'y' }
            ]
        },
        options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false },
            plugins: { legend: { labels: { color: '#888', font: { size: 10 } } } },
            scales: { x: { ticks: { color: '#666', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y: { type: 'linear', position: 'left', ticks: { color: '#48dbfb', font: { size: 9 } }, grid: { color: 'rgba(255,255,255,0.05)' } },
                y1: { type: 'linear', position: 'right', ticks: { color: '#feca57', font: { size: 9 } }, grid: { drawOnChartArea: false } }
            }
        }
    });
}
</script>
</body>
</html>
