<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è‚¡åšç©ºè¨Šè™Ÿç›£æ§ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Microsoft JhengHei', 'PingFang TC', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #eee;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container { max-width: 1400px; margin: 0 auto; }
        
        header {
            text-align: center;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            margin-bottom: 20px;
        }
        
        header h1 {
            font-size: 2em;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }
        
        .update-time { color: #888; font-size: 0.9em; }
        
        .loading-screen {
            text-align: center;
            padding: 100px 20px;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid #333;
            border-top-color: #48dbfb;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text { color: #888; font-size: 1.1em; }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
        }
        
        .card-title {
            font-size: 1.1em;
            color: #48dbfb;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .price-display { text-align: center; padding: 20px; }
        .price-main { font-size: 2.5em; font-weight: bold; }
        .price-change { font-size: 1.2em; margin-top: 5px; }
        .price-up { color: #ff6b6b; }
        .price-down { color: #26de81; }
        
        .indicator-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .indicator-label { color: #aaa; }
        .indicator-value { font-weight: bold; }
        
        .heat-score { text-align: center; padding: 30px; }
        .heat-score .score { font-size: 4em; font-weight: bold; }
        .heat-score .max { font-size: 1.5em; color: #666; }
        
        .heat-level {
            margin-top: 15px;
            padding: 10px 20px;
            border-radius: 20px;
            display: inline-block;
            font-weight: bold;
        }
        
        .heat-low { background: #26de81; color: #000; }
        .heat-medium { background: #feca57; color: #000; }
        .heat-high { background: #ff6b6b; color: #fff; }
        .heat-extreme { background: #ff0000; color: #fff; animation: pulse 1s infinite; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .heat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: rgba(255,255,255,0.03);
            border-radius: 8px;
        }
        
        .heat-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 10px;
        }
        
        .heat-dot.active { background: #ff6b6b; }
        .heat-dot.inactive { background: #444; }
        
        .signal-card {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            background: rgba(255,255,255,0.03);
        }
        
        .signal-triggered {
            background: rgba(255,107,107,0.2);
            border-left: 4px solid #ff6b6b;
        }
        
        .signal-name { font-weight: bold; margin-bottom: 5px; }
        
        .signal-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .signal-badge {
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.85em;
        }
        
        .badge-triggered { background: #ff6b6b; color: #fff; }
        .badge-waiting { background: #444; color: #888; }
        
        .ma-table { width: 100%; }
        .ma-table th, .ma-table td { padding: 10px; text-align: center; }
        .ma-table th { color: #888; font-weight: normal; }
        .status-above { color: #26de81; }
        .status-below { color: #ff6b6b; }
        
        .action-box {
            background: linear-gradient(135deg, rgba(102,126,234,0.2), rgba(118,75,162,0.2));
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        
        .action-title { font-size: 1.3em; margin-bottom: 15px; }
        .action-suggestion { font-size: 1.1em; color: #feca57; line-height: 1.6; }
        
        .key-levels {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 20px;
        }
        
        .level-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .level-price { font-size: 1.5em; font-weight: bold; color: #48dbfb; }
        .level-label { color: #888; font-size: 0.9em; margin-top: 5px; }
        
        .chart-container { height: 300px; margin-top: 15px; }
        
        .strategy-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .strategy-table th, .strategy-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .strategy-table th { color: #48dbfb; font-weight: normal; }
        
        .position-bar {
            height: 8px;
            background: #333;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 5px;
        }
        
        .position-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 4px;
        }
        
        .error-box {
            background: rgba(255,107,107,0.2);
            border: 1px solid #ff6b6b;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        .refresh-btn {
            margin-top: 15px;
            padding: 10px 25px;
            background: #667eea;
            border: none;
            border-radius: 5px;
            color: #fff;
            cursor: pointer;
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.85em;
            margin-top: 30px;
        }
        
        @media (max-width: 768px) {
            .grid { grid-template-columns: 1fr; }
            header h1 { font-size: 1.5em; }
            .key-levels { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ“‰ å°è‚¡åšç©ºè¨Šè™Ÿç›£æ§ç³»çµ±</h1>
            <p class="update-time">è³‡æ–™æ›´æ–°æ™‚é–“ï¼š<span id="updateTime">è¼‰å…¥ä¸­...</span></p>
        </header>
        
        <div id="mainContent">
            <div class="loading-screen">
                <div class="loading-spinner"></div>
                <div class="loading-text">æ­£åœ¨å¾ GitHub è¼‰å…¥è³‡æ–™...</div>
            </div>
        </div>
        
        <footer>
            <p>âš ï¸ æŠ•è³‡é¢¨éšªæé†’ï¼šåšç©ºæ“ä½œé¢¨éšªæ¥µé«˜ï¼Œæ­·å²æ•¸æ“šä¸ä»£è¡¨æœªä¾†è¡¨ç¾ï¼Œè«‹å¯©æ…è©•ä¼°é¢¨éšªæ‰¿å—èƒ½åŠ›ã€‚</p>
            <p>æœ¬ç³»çµ±åƒ…ä¾›è³‡æ–™æ•´ç†åƒè€ƒï¼Œä¸æ§‹æˆä»»ä½•æŠ•è³‡å»ºè­°ã€‚</p>
        </footer>
    </div>
    
    <script>
    // ====================================================================
    // ğŸ”§ è¨­å®šå€ - è«‹ä¿®æ”¹é€™è£¡çš„ GitHub Raw URL
    // ====================================================================
    const CONFIG = {
        // è«‹å°‡ä¸‹æ–¹ç¶²å€æ”¹æˆä½ çš„ GitHub Raw URL
        // æ ¼å¼ï¼šhttps://raw.githubusercontent.com/ä½ çš„å¸³è™Ÿ/ä½ çš„repo/main/æª”æ¡ˆåç¨±.csv
        
        TXINDEX_URL: 'https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/TXINDEX.csv',
        TSMC_URL: 'https://raw.githubusercontent.com/YOUR_USERNAME/YOUR_REPO/main/2330.csv',
        
        // OTC é¸å¡«ï¼Œå¦‚æœæ²’æœ‰å¯ä»¥ç•™ç©ºå­—ä¸² ''
        OTC_URL: ''
    };
    // ====================================================================
    
    let rawData = { tx: null, tsmc: null };
    let processedData = [];
    let priceChart = null;
    
    // é é¢è¼‰å…¥æ™‚è‡ªå‹•åŸ·è¡Œ
    window.onload = function() {
        loadAllData();
    };
    
    // è¼‰å…¥æ‰€æœ‰è³‡æ–™
    async function loadAllData() {
        try {
            document.getElementById('mainContent').innerHTML = `
                <div class="loading-screen">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">æ­£åœ¨å¾ GitHub è¼‰å…¥è³‡æ–™...</div>
                </div>
            `;
            
            // åŒæ™‚è¼‰å…¥å…©å€‹æª”æ¡ˆ
            const [txData, tsmcData] = await Promise.all([
                fetchCSV(CONFIG.TXINDEX_URL),
                fetchCSV(CONFIG.TSMC_URL)
            ]);
            
            rawData.tx = txData;
            rawData.tsmc = tsmcData;
            
            // è™•ç†ä¸¦é¡¯ç¤º
            processData();
            
        } catch (error) {
            console.error('è¼‰å…¥éŒ¯èª¤:', error);
            document.getElementById('mainContent').innerHTML = `
                <div class="error-box">
                    <h3>âŒ è³‡æ–™è¼‰å…¥å¤±æ•—</h3>
                    <p style="margin-top:10px; color:#aaa;">${error.message}</p>
                    <p style="margin-top:10px; color:#888; font-size:0.9em;">
                        è«‹ç¢ºèªï¼š<br>
                        1. GitHub URL è¨­å®šæ­£ç¢º<br>
                        2. Repository æ˜¯ Public<br>
                        3. æª”æ¡ˆåç¨±æ­£ç¢º
                    </p>
                    <button class="refresh-btn" onclick="loadAllData()">é‡æ–°è¼‰å…¥</button>
                </div>
            `;
        }
    }
    
    // å¾ URL è¼‰å…¥ CSV
    function fetchCSV(url) {
        return new Promise((resolve, reject) => {
            if (!url || url.includes('YOUR_USERNAME')) {
                reject(new Error('è«‹å…ˆè¨­å®š GitHub URLï¼ˆåœ¨ HTML æª”æ¡ˆä¸­çš„ CONFIG å€å¡Šï¼‰'));
                return;
            }
            
            Papa.parse(url, {
                download: true,
                header: true,
                skipEmptyLines: true,
                complete: function(results) {
                    if (results.data && results.data.length > 0) {
                        // éæ¿¾æœ‰æ•ˆè³‡æ–™
                        const validData = results.data.filter(row => {
                            const date = row['æ—¥æœŸ'] || row['Date'] || row['date'];
                            return date && date.length > 0;
                        });
                        resolve(validData);
                    } else {
                        reject(new Error('CSV æª”æ¡ˆæ²’æœ‰æœ‰æ•ˆè³‡æ–™'));
                    }
                },
                error: function(error) {
                    reject(new Error('ç„¡æ³•è¼‰å…¥æª”æ¡ˆ: ' + error.message));
                }
            });
        });
    }
    
    // å–å¾—æ¬„ä½å€¼
    function getField(row, ...names) {
        for (let name of names) {
            if (row[name] !== undefined && row[name] !== '') {
                return row[name];
            }
        }
        return null;
    }
    
    // è§£ææ•¸å­—
    function parseNum(val) {
        if (val === null || val === undefined || val === '') return NaN;
        return parseFloat(String(val).replace(/,/g, ''));
    }
    
    // è¨ˆç®—ç§»å‹•å¹³å‡
    function calcMA(data, field, period) {
        let result = [];
        for (let i = 0; i < data.length; i++) {
            if (i < period - 1) {
                result.push(NaN);
            } else {
                let sum = 0;
                for (let j = 0; j < period; j++) {
                    sum += data[i - j][field];
                }
                result.push(sum / period);
            }
        }
        return result;
    }
    
    // è¨ˆç®— RSI
    function calcRSI(data, field, period) {
        let result = [];
        let gains = [];
        let losses = [];
        
        for (let i = 0; i < data.length; i++) {
            if (i === 0) {
                result.push(50);
                continue;
            }
            
            let change = data[i][field] - data[i-1][field];
            gains.push(change > 0 ? change : 0);
            losses.push(change < 0 ? -change : 0);
            
            if (i < period) {
                result.push(50);
            } else {
                let avgGain = gains.slice(-period).reduce((a,b) => a+b, 0) / period;
                let avgLoss = losses.slice(-period).reduce((a,b) => a+b, 0) / period;
                
                if (avgLoss === 0) {
                    result.push(100);
                } else {
                    let rs = avgGain / avgLoss;
                    result.push(100 - (100 / (1 + rs)));
                }
            }
        }
        return result;
    }
    
    // è™•ç†è³‡æ–™
    function processData() {
        // æ•´ç†åŠ æ¬ŠæŒ‡æ•¸
        let txData = rawData.tx.map(row => ({
            date: getField(row, 'æ—¥æœŸ', 'Date', 'date'),
            close: parseNum(getField(row, 'æ”¶ç›¤åƒ¹', 'æ”¶ç›¤æŒ‡æ•¸', 'Close', 'close')),
            open: parseNum(getField(row, 'é–‹ç›¤åƒ¹', 'é–‹ç›¤æŒ‡æ•¸', 'Open', 'open')),
            high: parseNum(getField(row, 'æœ€é«˜åƒ¹', 'æœ€é«˜æŒ‡æ•¸', 'High', 'high')),
            low: parseNum(getField(row, 'æœ€ä½åƒ¹', 'æœ€ä½æŒ‡æ•¸', 'Low', 'low')),
            volume: parseNum(getField(row, 'æˆäº¤é‡', 'æˆäº¤é‡‘é¡', 'Volume', 'volume')),
            foreign: parseNum(getField(row, 'å¤–è³‡è²·è³£è¶…', 'å¤–è³‡', 'Foreign')),
            trust: parseNum(getField(row, 'æŠ•ä¿¡è²·è³£è¶…', 'æŠ•ä¿¡', 'Trust')),
            margin: parseNum(getField(row, 'èè³‡é¤˜é¡', 'èè³‡', 'Margin'))
        })).filter(d => !isNaN(d.close));
        
        // æ•´ç†å°ç©é›»
        let tsmcMap = {};
        rawData.tsmc.forEach(row => {
            let dateStr = getField(row, 'æ—¥æœŸ', 'Date', 'date');
            tsmcMap[dateStr] = {
                close: parseNum(getField(row, 'æ”¶ç›¤åƒ¹', 'Close', 'close'))
            };
        });
        
        // åˆä½µ
        let merged = txData.map(tx => ({
            ...tx,
            tsmcClose: tsmcMap[tx.date]?.close || NaN
        })).filter(d => !isNaN(d.tsmcClose));
        
        // å–æœ€è¿‘ 120 å¤©
        merged = merged.slice(-120);
        
        // è¨ˆç®—æŒ‡æ¨™
        let ma5 = calcMA(merged, 'close', 5);
        let ma20 = calcMA(merged, 'close', 20);
        let ma60 = calcMA(merged, 'close', 60);
        let rsi = calcRSI(merged, 'close', 14);
        
        let tsmcMa5 = calcMA(merged, 'tsmcClose', 5);
        let tsmcMa20 = calcMA(merged, 'tsmcClose', 20);
        let tsmcMa60 = calcMA(merged, 'tsmcClose', 60);
        
        // çµ„åˆæœ€çµ‚è³‡æ–™
        processedData = merged.map((row, i) => {
            let dayReturn = i > 0 ? (row.close / merged[i-1].close - 1) * 100 : 0;
            let tsmcReturn = i > 0 ? (row.tsmcClose / merged[i-1].tsmcClose - 1) * 100 : 0;
            let bias20 = ma20[i] ? (row.close / ma20[i] - 1) * 100 : 0;
            
            let marginChange = 0;
            if (i >= 20 && merged[i-20].margin) {
                marginChange = (row.margin / merged[i-20].margin - 1) * 100;
            }
            
            let foreign5 = 0;
            for (let j = 0; j < 5 && i-j >= 0; j++) {
                foreign5 += merged[i-j].foreign || 0;
            }
            
            let gain60 = i >= 60 ? (row.close / merged[i-60].close - 1) * 100 : 0;
            let gain120 = i >= 119 ? (row.close / merged[i-119].close - 1) * 100 : 0;
            
            let high52 = row.close;
            for (let j = 0; j < Math.min(240, i+1); j++) {
                if (merged[i-j].close > high52) high52 = merged[i-j].close;
            }
            let distHigh = (row.close / high52 - 1) * 100;
            
            return {
                date: row.date,
                close: row.close,
                dayReturn,
                ma5: ma5[i],
                ma20: ma20[i],
                ma60: ma60[i],
                rsi: rsi[i],
                bias20,
                foreign: row.foreign,
                foreign5,
                trust: row.trust,
                margin: row.margin,
                marginChange,
                tsmcClose: row.tsmcClose,
                tsmcReturn,
                tsmcMa5: tsmcMa5[i],
                tsmcMa20: tsmcMa20[i],
                tsmcMa60: tsmcMa60[i],
                gain60,
                gain120,
                distHigh
            };
        });
        
        renderDashboard();
    }
    
    // æ¸²æŸ“å„€è¡¨æ¿
    function renderDashboard() {
        const latest = processedData[processedData.length - 1];
        
        document.getElementById('updateTime').textContent = latest.date;
        
        // éç†±æª¢æŸ¥
        const heatChecks = [
            { name: 'ä¹–é›¢ç‡ > 3%', check: latest.bias20 > 3, value: latest.bias20.toFixed(2) + '%' },
            { name: 'ä¹–é›¢ç‡ > 5%', check: latest.bias20 > 5, value: latest.bias20.toFixed(2) + '%' },
            { name: 'RSI > 70', check: latest.rsi > 70, value: latest.rsi.toFixed(1) },
            { name: 'RSI > 75', check: latest.rsi > 75, value: latest.rsi.toFixed(1) },
            { name: 'èè³‡å¢ > 5%', check: latest.marginChange > 5, value: (latest.marginChange || 0).toFixed(2) + '%' },
            { name: 'èè³‡å¢ > 7%', check: latest.marginChange > 7, value: (latest.marginChange || 0).toFixed(2) + '%' },
            { name: '60æ—¥æ¼² > 15%', check: latest.gain60 > 15, value: latest.gain60.toFixed(2) + '%' },
            { name: '120æ—¥æ¼² > 25%', check: latest.gain120 > 25, value: latest.gain120.toFixed(2) + '%' },
            { name: 'æ¥è¿‘52é€±é«˜', check: latest.distHigh > -3, value: latest.distHigh.toFixed(2) + '%' },
        ];
        
        const heatScore = heatChecks.filter(h => h.check).length;
        
        // è¨Šè™Ÿåˆ¤æ–·
        const signals = {
            trial: latest.close > latest.ma20 && latest.dayReturn < -1 && latest.foreign < 0 && latest.tsmcReturn < 0,
            build: latest.close < latest.ma20 && latest.tsmcClose < latest.tsmcMa20,
            add: latest.close < latest.ma60 && latest.tsmcClose < latest.tsmcMa60,
            heavy: false
        };
        
        // HTML
        let html = `
            <div class="grid">
                <div class="card">
                    <div class="card-title">ğŸ“Š åŠ æ¬ŠæŒ‡æ•¸</div>
                    <div class="price-display">
                        <div class="price-main">${latest.close.toLocaleString()}</div>
                        <div class="price-change ${latest.dayReturn >= 0 ? 'price-up' : 'price-down'}">
                            ${latest.dayReturn >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(latest.dayReturn).toFixed(2)}%
                        </div>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">20æ—¥ä¹–é›¢ç‡</span>
                        <span class="indicator-value">${latest.bias20.toFixed(2)}%</span>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">RSI(14)</span>
                        <span class="indicator-value">${latest.rsi.toFixed(1)}</span>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">å¤–è³‡è²·è³£è¶…</span>
                        <span class="indicator-value ${latest.foreign >= 0 ? 'price-up' : 'price-down'}">${((latest.foreign||0)/1e8).toFixed(1)}å„„</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ­ å°ç©é›» (2330)</div>
                    <div class="price-display">
                        <div class="price-main">${latest.tsmcClose.toLocaleString()}</div>
                        <div class="price-change ${latest.tsmcReturn >= 0 ? 'price-up' : 'price-down'}">
                            ${latest.tsmcReturn >= 0 ? 'â–²' : 'â–¼'} ${Math.abs(latest.tsmcReturn).toFixed(2)}%
                        </div>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">5æ—¥å‡ç·š</span>
                        <span class="indicator-value">${latest.tsmcMa5?.toFixed(0) || '-'}</span>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">20æ—¥å‡ç·š</span>
                        <span class="indicator-value">${latest.tsmcMa20?.toFixed(0) || '-'}</span>
                    </div>
                    <div class="indicator-row">
                        <span class="indicator-label">60æ—¥å‡ç·š</span>
                        <span class="indicator-value">${latest.tsmcMa60?.toFixed(0) || '-'}</span>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸŒ¡ï¸ éç†±åˆ†æ•¸</div>
                    <div class="heat-score">
                        <span class="score" style="color: ${getHeatColor(heatScore)}">${heatScore}</span>
                        <span class="max">/ 9</span>
                        <div class="heat-level ${getHeatClass(heatScore)}">
                            ${getHeatText(heatScore)}
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="grid">
                <div class="card">
                    <div class="card-title">ğŸ“‹ éç†±æŒ‡æ¨™æ˜ç´°</div>
                    ${heatChecks.map(h => `
                        <div class="heat-item">
                            <div style="display: flex; align-items: center;">
                                <div class="heat-dot ${h.check ? 'active' : 'inactive'}"></div>
                                <span>${h.name}</span>
                            </div>
                            <span>${h.value}</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ“ˆ å‡ç·šç‹€æ…‹</div>
                    <table class="ma-table">
                        <tr><th></th><th>åŠ æ¬ŠæŒ‡æ•¸</th><th>ç‹€æ…‹</th><th>å°ç©é›»</th><th>ç‹€æ…‹</th></tr>
                        <tr>
                            <td>5æ—¥å‡</td>
                            <td>${latest.ma5?.toFixed(0) || '-'}</td>
                            <td class="${latest.close > latest.ma5 ? 'status-above' : 'status-below'}">${latest.close > latest.ma5 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                            <td>${latest.tsmcMa5?.toFixed(0) || '-'}</td>
                            <td class="${latest.tsmcClose > latest.tsmcMa5 ? 'status-above' : 'status-below'}">${latest.tsmcClose > latest.tsmcMa5 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                        </tr>
                        <tr>
                            <td>20æ—¥å‡</td>
                            <td>${latest.ma20?.toFixed(0) || '-'}</td>
                            <td class="${latest.close > latest.ma20 ? 'status-above' : 'status-below'}">${latest.close > latest.ma20 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                            <td>${latest.tsmcMa20?.toFixed(0) || '-'}</td>
                            <td class="${latest.tsmcClose > latest.tsmcMa20 ? 'status-above' : 'status-below'}">${latest.tsmcClose > latest.tsmcMa20 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                        </tr>
                        <tr>
                            <td>60æ—¥å‡</td>
                            <td>${latest.ma60?.toFixed(0) || '-'}</td>
                            <td class="${latest.close > latest.ma60 ? 'status-above' : 'status-below'}">${latest.close > latest.ma60 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                            <td>${latest.tsmcMa60?.toFixed(0) || '-'}</td>
                            <td class="${latest.tsmcClose > latest.tsmcMa60 ? 'status-above' : 'status-below'}">${latest.tsmcClose > latest.tsmcMa60 ? 'âœ“ç«™ä¸Š' : 'âœ—è·Œç ´'}</td>
                        </tr>
                    </table>
                </div>
                
                <div class="card">
                    <div class="card-title">ğŸ¯ åšç©ºè¨Šè™Ÿæª¢æ¸¬</div>
                    <div class="signal-card ${signals.trial ? 'signal-triggered' : ''}">
                        <div class="signal-name">è©¦å–®è¨Šè™Ÿï¼ˆ10%éƒ¨ä½ï¼‰</div>
                        <div class="signal-status">
                            <span>é«˜æª”+æ”¶é»‘>1%+å¤–è³‡è³£+å°ç©é»‘</span>
                            <span class="signal-badge ${signals.trial ? 'badge-triggered' : 'badge-waiting'}">${signals.trial ? 'ğŸ”´ è§¸ç™¼' : 'âšª ç­‰å¾…'}</span>
                        </div>
                    </div>
                    <div class="signal-card ${signals.build ? 'signal-triggered' : ''}">
                        <div class="signal-name">å»ºå€‰è¨Šè™Ÿï¼ˆ30%éƒ¨ä½ï¼‰</div>
                        <div class="signal-status">
                            <span>ç ´20å‡+å°ç©ç ´20å‡</span>
                            <span class="signal-badge ${signals.build ? 'badge-triggered' : 'badge-waiting'}">${signals.build ? 'ğŸ”´ è§¸ç™¼' : 'âšª ç­‰å¾…'}</span>
                        </div>
                    </div>
                    <div class="signal-card ${signals.add ? 'signal-triggered' : ''}">
                        <div class="signal-name">åŠ ç¢¼è¨Šè™Ÿï¼ˆ50%éƒ¨ä½ï¼‰</div>
                        <div class="signal-status">
                            <span>ç ´60å‡+å°ç©ç ´60å‡</span>
                            <span class="signal-badge ${signals.add ? 'badge-triggered' : 'badge-waiting'}">${signals.add ? 'ğŸ”´ è§¸ç™¼' : 'âšª ç­‰å¾…'}</span>
                        </div>
                    </div>
                    <div class="signal-card">
                        <div class="signal-name">é‡å£“è¨Šè™Ÿï¼ˆ80%éƒ¨ä½ï¼‰</div>
                        <div class="signal-status">
                            <span>åå½ˆå¤±æ•—ç¢ºèªï¼ˆæ‰‹å‹•åˆ¤æ–·ï¼‰</span>
                            <span class="signal-badge badge-waiting">âšª ç­‰å¾…</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="card action-box">
                <div class="action-title">ğŸ“Œ ä»Šæ—¥è¡Œå‹•å»ºè­°</div>
                <div class="action-suggestion">${getActionSuggestion(heatScore, signals)}</div>
                <div class="key-levels">
                    <div class="level-item">
                        <div class="level-price">${latest.ma20?.toFixed(0) || '-'}</div>
                        <div class="level-label">20æ—¥å‡ç·šï¼ˆå»ºå€‰é»ï¼‰</div>
                    </div>
                    <div class="level-item">
                        <div class="level-price">${latest.ma60?.toFixed(0) || '-'}</div>
                        <div class="level-label">60æ—¥å‡ç·šï¼ˆåŠ ç¢¼é»ï¼‰</div>
                    </div>
                    <div class="level-item">
                        <div class="level-price">${latest.tsmcMa20?.toFixed(0) || '-'}</div>
                        <div class="level-label">å°ç©20å‡ï¼ˆç¢ºèªé»ï¼‰</div>
                    </div>
                    <div class="level-item">
                        <div class="level-price">${latest.tsmcMa60?.toFixed(0) || '-'}</div>
                        <div class="level-label">å°ç©60å‡ï¼ˆç¢ºèªé»ï¼‰</div>
                    </div>
                </div>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <div class="card-title">ğŸ“Š é‡‘å­—å¡”åŠ æ¸›ç¢¼ç­–ç•¥</div>
                <table class="strategy-table">
                    <tr><th>éšæ®µ</th><th>éƒ¨ä½</th><th>é€²å ´æ¢ä»¶</th><th>åœæ</th><th>æ­·å²å‹ç‡</th></tr>
                    <tr><td>è§€å¯ŸæœŸ</td><td><div class="position-bar"><div class="position-fill" style="width:0%"></div></div>0%</td><td>éç†±åˆ†æ•¸ â‰¥ 5</td><td>-</td><td>-</td></tr>
                    <tr><td>è©¦å–®æœŸ</td><td><div class="position-bar"><div class="position-fill" style="width:10%"></div></div>10%</td><td>é«˜æª”æ”¶é»‘+å¤–è³‡è³£+å°ç©é»‘</td><td>é€²å ´åƒ¹ +3%</td><td>~45%</td></tr>
                    <tr><td>å»ºå€‰æœŸ</td><td><div class="position-bar"><div class="position-fill" style="width:30%"></div></div>30%</td><td>è·Œç ´20æ—¥å‡ç·š</td><td>20å‡ +2%</td><td>~49%</td></tr>
                    <tr><td>åŠ ç¢¼æœŸ</td><td><div class="position-bar"><div class="position-fill" style="width:50%"></div></div>50%</td><td>è·Œç ´60æ—¥å‡ç·š</td><td>60å‡ +2%</td><td>~49%</td></tr>
                    <tr><td>é‡å£“æœŸ</td><td><div class="position-bar"><div class="position-fill" style="width:80%"></div></div>80%</td><td>åå½ˆå¤±æ•—ç¢ºèª</td><td>åå½ˆé«˜é» +1%</td><td>~56%</td></tr>
                </table>
            </div>
            
            <div class="card" style="margin-top: 20px;">
                <div class="card-title">ğŸ“ˆ è¿‘æœŸèµ°å‹¢</div>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
        `;
        
        document.getElementById('mainContent').innerHTML = html;
        renderChart();
    }
    
    function getHeatColor(score) {
        if (score >= 7) return '#ff0000';
        if (score >= 5) return '#ff6b6b';
        if (score >= 3) return '#feca57';
        return '#26de81';
    }
    
    function getHeatClass(score) {
        if (score >= 7) return 'heat-extreme';
        if (score >= 5) return 'heat-high';
        if (score >= 3) return 'heat-medium';
        return 'heat-low';
    }
    
    function getHeatText(score) {
        if (score >= 7) return 'ğŸ”¥ é«˜åº¦éç†±';
        if (score >= 5) return 'âš ï¸ ä¸­åº¦éç†±';
        if (score >= 3) return 'ğŸ“Š è¼•åº¦éç†±';
        return 'âœ… å°šæœªéç†±';
    }
    
    function getActionSuggestion(score, signals) {
        if (signals.add) return 'âš¡ åŠ ç¢¼è¨Šè™Ÿå·²è§¸ç™¼ï¼å¯è€ƒæ…®å°‡ç©ºå–®éƒ¨ä½åŠ ç¢¼è‡³50%ï¼Œåœæè¨­åœ¨60æ—¥å‡ç·šä¸Šæ–¹2%';
        if (signals.build) return 'ğŸ“‰ å»ºå€‰è¨Šè™Ÿå·²è§¸ç™¼ï¼å¯è€ƒæ…®å°‡ç©ºå–®éƒ¨ä½åŠ ç¢¼è‡³30%ï¼Œåœæè¨­åœ¨20æ—¥å‡ç·šä¸Šæ–¹2%';
        if (signals.trial) return 'ğŸ¯ è©¦å–®è¨Šè™Ÿè§¸ç™¼ï¼å¯è€ƒæ…®å»ºç«‹10%ç©ºå–®éƒ¨ä½è©¦å–®ï¼Œåœæè¨­åœ¨é€²å ´åƒ¹ä¸Šæ–¹3%';
        if (score >= 7) return 'å¸‚å ´é«˜åº¦éç†±ï¼Œæº–å‚™è©¦å–®è³‡é‡‘ã€‚ç­‰å¾…æ¢ä»¶ï¼šæ”¶é»‘>1% + å¤–è³‡è³£è¶… + å°ç©é›»æ”¶é»‘';
        if (score >= 5) return 'å¸‚å ´ä¸­åº¦éç†±ï¼Œé€²å…¥è§€å¯ŸæœŸã€‚å¯†åˆ‡é—œæ³¨è½‰å¼±è¨Šè™Ÿï¼Œè‹¥æ˜æ—¥æ”¶é»‘+å¤–è³‡è³£è¶…å¯è€ƒæ…®å°é‡è©¦å–®';
        if (score >= 3) return 'å¸‚å ´è¼•åº¦éç†±ï¼ŒæŒçºŒè§€å¯Ÿã€‚å°šæœªåˆ°ç†æƒ³åšç©ºæ™‚æ©Ÿï¼Œè€å¿ƒç­‰å¾…éç†±åˆ†æ•¸ä¸Šå‡';
        return 'å¸‚å ´å°šæœªéç†±ï¼Œæš«ä¸å»ºè­°åšç©ºã€‚å¸‚å ´ä»æœ‰ä¸Šæ¼²å‹•èƒ½ï¼Œä¿æŒè§€æœ›';
    }
    
    function renderChart() {
        const ctx = document.getElementById('priceChart').getContext('2d');
        const last30 = processedData.slice(-30);
        
        if (priceChart) priceChart.destroy();
        
        priceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: last30.map(d => d.date.slice(5)),
                datasets: [
                    {
                        label: 'åŠ æ¬ŠæŒ‡æ•¸',
                        data: last30.map(d => d.close),
                        borderColor: '#48dbfb',
                        backgroundColor: 'rgba(72,219,251,0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: '20æ—¥å‡ç·š',
                        data: last30.map(d => d.ma20),
                        borderColor: '#feca57',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    },
                    {
                        label: '60æ—¥å‡ç·š',
                        data: last30.map(d => d.ma60),
                        borderColor: '#ff6b6b',
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                interaction: { intersect: false, mode: 'index' },
                plugins: { legend: { labels: { color: '#888' } } },
                scales: {
                    x: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } },
                    y: { ticks: { color: '#888' }, grid: { color: 'rgba(255,255,255,0.05)' } }
                }
            }
        });
    }
    </script>
</body>
</html>
